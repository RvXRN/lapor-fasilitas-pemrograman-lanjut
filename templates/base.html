<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}LaporIN{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="bg-light">

    <div class="d-flex" id="wrapper">
        {% if current_user.is_authenticated %}
            <!-- ================= Sidebar ================= -->
            <div class="bg-dark text-white" id="sidebar-wrapper">
               <div class="p-3 border-bottom border-secondary">
    <div class="d-flex align-items-center">
        <img src="{{ url_for('static', filename='img/logo.png') }}"
             alt="Logo LaporIN"
             style="width: 38px; height: 38px; object-fit: contain; margin-right: 0.7rem;">
        <h4 class="text-warning mb-0" style="font-weight:700; letter-spacing:1px;">
            LaporIN
        </h4>
    </div>
    <div class="text-center mt-2 sidebar-desc">
        Sistem Pelaporan Fasilitas Publik
    </div>
</div>

               <div class="list-group list-group-flush">
    <a href="{{ url_for('index') }}"
   class="list-group-item bg-dark text-white border-0 {% if request.path == '/' %}active{% endif %}">
    <i class="bi bi-house"></i> Dashboard
</a>
<a href="{{ url_for('tambah_laporan') }}"
   class="list-group-item bg-dark text-white border-0 {% if request.path == '/tambah_laporan' %}active{% endif %}">
    <i class="bi bi-plus-circle"></i> Buat Laporan
</a>
<a href="{{ url_for('laporan_saya') }}"
   class="list-group-item bg-dark text-white border-0 {% if request.path == '/laporan_saya' %}active{% endif %}">
    <i class="bi bi-list-check"></i> Laporan Saya
</a>
<a href="{{ url_for('riwayat') }}"
   class="list-group-item bg-dark text-white border-0 {% if request.path == '/riwayat' %}active{% endif %}">
    <i class="bi bi-clock-history"></i> Histori
</a>
<a href="{{ url_for('tentang') }}"
   class="list-group-item bg-dark text-white border-0 {% if request.path == '/tentang' %}active{% endif %}">
    <i class="bi bi-info-circle"></i> Tentang
</a>

   {% if current_user.role == 'admin' %}
    <a href="{{ url_for('kelola_pengguna') }}" class="list-group-item bg-dark text-white border-0 {% if request.path == '/kelola_pengguna' %}active{% endif %}">
        <i class="bi bi-people"></i> Kelola Pengguna
    </a>
{% endif %}

    <a href="#" class="list-group-item bg-dark text-white border-0" data-bs-toggle="modal" data-bs-target="#logoutModal">
  <i class="bi bi-box-arrow-right"></i> Logout
    </a>

</div>
  </div>
        {% endif %}

        <!-- ================= Page Content ================= -->
        <div id="page-content-wrapper" class="flex-fill">
            {% if current_user.is_authenticated %}
                <!-- Navbar -->
                <nav class="navbar navbar-light bg-light border-bottom shadow-sm">
                    <div class="container-fluid">
    <button class="btn btn-dark" id="menu-toggle">
        <i class="bi bi-list"></i>
    </button>
    
    <!-- Profil kiri email -->
   <div class="d-flex align-items-center ms-auto gap-2">
    <!-- Theme toggle button -->
    <button id="toggle-theme" class="btn btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center me-1" style="width:38px;height:38px" aria-label="Toggle Dark/Light">
    <i class="bi bi-brightness-high" id="theme-icon" style="font-size:1.3rem;"></i>
    </button>

    <div class="dropdown">
        <img src="{{ url_for('static', filename='img/profil.png') }}"
             alt="Profil"
             class="rounded-circle"
             style="width:32px; height:32px; object-fit:cover; cursor:pointer;"
             id="navbarProfileDropdown"
             data-bs-toggle="dropdown" aria-expanded="false">
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarProfileDropdown">
            <li>
                <a class="dropdown-item" href="{{ url_for('profil') }}">
                    <i class="bi bi-person-circle me-2"></i> Lihat Profil
                </a>
            </li>
        </ul>
    </div>
    <span class="text-muted small">{{ current_user.email }}</span>
</div>

</div>
</nav>
{% endif %}

            <!-- ================= Main Content ================= -->
          <div class="container-fluid p-4">
    {% if request.path == '/' %}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' if category == 'success' else 'info' }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    {% endif %}
    {% block content %}{% endblock %}
</div>

</div>
</div>
</div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    const togglePassword = document.getElementById("togglePassword");
    const passwordField = document.getElementById("password");

    if (togglePassword && passwordField) {
        togglePassword.addEventListener("click", function () {
            const isPassword = passwordField.getAttribute("type") === "password";
            passwordField.setAttribute("type", isPassword ? "text" : "password");

            const icon = this.querySelector("i");
            icon.classList.toggle("bi-eye");
            icon.classList.toggle("bi-eye-slash");
        });
    }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const noTelp = document.getElementById('no_telp');
    
    noTelp.addEventListener('input', function () {
        this.value = this.value.replace(/[^0-9]/g, ''); // Hanya angka
        if (this.value.length > 13) this.value = this.value.slice(0, 13);
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('form');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');

    form.addEventListener('submit', function (e) {
        if (password.value !== confirmPassword.value) {
            e.preventDefault();
            confirmPassword.classList.add('is-invalid');
            confirmPassword.focus();
        } else {
            confirmPassword.classList.remove('is-invalid');
        }
    });

    // Hapus error saat mengetik
    confirmPassword.addEventListener('input', function () {
        if (password.value === confirmPassword.value) {
            confirmPassword.classList.remove('is-invalid');
        }
    });
});
</script>


    <!-- Sidebar Toggle Script -->
    <script>
        const toggleButton = document.getElementById("menu-toggle");
        if (toggleButton) {
            toggleButton.addEventListener("click", function() {
                document.getElementById("wrapper").classList.toggle("toggled");
            });
        }
    </script>

    <!-- Modal Logout -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning-subtle">
        <h5 class="modal-title" id="logoutModalLabel">Konfirmasi Keluar</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
      </div>
      <div class="modal-body text-center">
        Apakah Anda Yakin Keluar dari Sistem ini?<br>Segala informasi akan tetap kami sampaikan melalui email atau No.Telepon Anda.
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Batal</button>
        <a href="{{ url_for('logout') }}" class="btn btn-warning px-4">Keluar</a>
      </div>
    </div>
  </div>
</div>

<script>
const themeBtn = document.getElementById('toggle-theme');
function setTheme(mode) {
    document.body.classList.remove('theme-dark', 'theme-light');
    document.body.classList.add(`theme-${mode}`);
    localStorage.setItem('theme', mode);
}
if (localStorage.getItem('theme') === 'dark') {
    setTheme('dark');
} else {
    setTheme('light');
}
themeBtn.addEventListener('click', function() {
    if (document.body.classList.contains('theme-dark')) {
        setTheme('light');
    } else {
        setTheme('dark');
    }
});
</script>



</body>
</html>
